# java-interview

### 场景面试题

#### 1.如何记录上亿用户连续登录天数？

1.选择数据结构：可以使用Redis的Hash跟BitMap两种数据结构比较适合做这个

-**Hash:**适合存储用户的连续登录天数或者是起始日期等辅助信息

-**Bitmap(位图)**:适合记录用户每天的登录状态（0/1）

**2.使用位图记录每天登录**

每个用户的登录状态可以映射到位图的一位：

**键设计：**login:{user_id}

**值**：位图，按天顺序记录用户是否登录。例如：

- `login:123` -> `...01101`，表示最近 5 天中第 1、3、4 天登录。

  ```bash
  SETBIT login:123 0 1  # 设置用户 123 第 0 天为登录状态
  SETBIT login:123 1 1  # 设置用户 123 第 1 天为登录状态
  GETBIT login:123 1    # 获取用户 123 第 1 天的登录状态
  
  ```

通过 `BITCOUNT` 可以统计用户总的登录天数，通过 `GETRANGE` 可以获取指定时间范围的登录情况。

3. **统计连续登录天数**

根据位图记录的登录数据，可以通过程序逻辑来计算连续登录天数：

- 遍历位图，找到最长连续的 `1`。
- 也可以结合 Redis 脚本（Lua）直接在 Redis 内部进行计算，减少数据传输。
